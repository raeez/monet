#!/bin/bash

if [ `whoami` == root ]; then
	echo Please DONT run this script as root, or using sudo
	exit
fi

echo ""
echo "****************************************"
echo "* Setting up memoize-dev environment *"
echo "****************************************"
echo ""

#mongodb snapshot sources
#sudo apt-add-repository 'deb http://downloads.mongodb.org/distros/ubuntu 10.10 10gen'
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10
sudo apt-get -y update
sudo apt-get -y upgrade

# system and python dependencies
sudo apt-get -y install git \
                    nginx \
                    mongodb \
                    python2.7 \
                    libpython2.7 \
                    python2.7-dev \
                    build-essential \

# dev env
wget -c http://pypi.python.org/packages/2.7/s/setuptools/setuptools-0.6c11-py2.7.egg#md5=fe1f997bc722265116870bc7919059ea
sudo sh setuptools-0.6c11-py2.7.egg

sudo python2.7 /usr/local/bin/easy_install-2.7 pip
sudo python2.7 /usr/local/bin/pip-2.7 install virtualenv

virtualenv -p python2.7 --no-site-packages --distribute --clear env

. env/bin/activate

# python dependencies
pip install Flask \
                PIL \
                sphinx \
                ipython \
                pymongo \
                pyflakes \
                py-bcrypt \
                flask-uploads \
                flask-celery \

ln -s $(pwd) env/lib/python2.7/site-packages/memoize


git clone git://fabfile.org/fabric.git fabric
cd fabric
python setup.py build
python setup.py install

echo ""
echo "***********************"
echo "* memoize-dev::Done! *"
echo "***********************"
echo ""
